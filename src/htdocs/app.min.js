"use strict";(function(){function a(a){var b={};return Object.keys(a).forEach(c=>{b[a[c]]=c}),b}function b(){ReactDOM.render(React.createElement(function(a){const b=a.facilities;var c=Object.keys(b).map(function(a){return React.createElement(j,{key:"filter_facility_"+b[a].toString(),value:b[a],label:a})});return React.createElement("div",null,"Facility",React.createElement("br",null),React.createElement("ul",null,c))},{facilities:e}),$("div.filter#facility")[0]),ReactDOM.render(React.createElement(function(a){const b=a.severity;var c=Object.keys(b).map(function(a){return React.createElement(k,{key:"filter_severity_"+b[a].toString(),value:b[a],label:a})});return React.createElement("div",null,"Severity",React.createElement("br",null),React.createElement("ul",null,c))},{severity:f}),$("div.filter#severity")[0]),fetch("/cgi-bin/hosts").then(function(a){a.json().then(function(a){ReactDOM.render(React.createElement(function(a){var b=a.hosts.map(function(a,b){return React.createElement(l,{key:"filter_host_"+b.toString(),value:a,label:a})});return React.createElement("div",null,"Hosts",React.createElement("br",null),React.createElement("ul",null,b))},{hosts:a}),$("div.filter#hostname")[0])})})}function c(){var a=Array.from($("input[data-type=severity]")).filter(b=>b.checked).map(b=>+b.value).reduce(function(a,b){return a|1<<b},0),b=Array.from($("input[data-type=facility]")).filter(b=>b.checked).map(b=>+b.value).reduce(function(a,b){return a|1<<b},0),c=Array.from($("input[data-type=host]")).filter(b=>b.checked).map(b=>b.value),d=new Date($("#filter_dtfrom")[0].value).getTime(),e=new Date($("#filter_dtto")[0].value).getTime(),f=new URLSearchParams;return f.append("ts",d),f.append("tf",e),c.forEach(a=>f.append("host",a)),f.append("nosev",a),f.append("nofac",b),f}function d(){fetch("/cgi-bin/list?"+c().toString()).then(function(a){a.json().then(function(a){function b(){function a(){return Math.floor(256*Math.random())}return"rgb("+[,,,].fill(0).map(function(){return a().toString()}).join(", ")+")"}i.facility.data.datasets[0].data=a.reduce((a,b)=>(a[b.data.PRI_FACILITY]+=1,a),Array(Object.keys(e).length).fill(0)),i.severity.data.datasets[0].data=a.reduce((a,b)=>(a[b.data.PRI_SEVERITY]+=1,a),Array(Object.keys(f).length).fill(0));var c=a.reduce((a,b)=>(null==a&&(a={}),0>Object.keys(a).indexOf(b.data.HEAD.hostname)?a[b.data.HEAD.hostname]=1:a[b.data.HEAD.hostname]+=1,a),{});i.host.data.labels=Object.keys(c),i.host.data.datasets[0].data=i.host.data.labels.map(a=>c[a]),Object.keys(i).forEach(a=>{i[a].data.datasets[0].backgroundColor=Array(i[a].data.datasets[0].data.length).fill(0).map(()=>b()),i[a].update(),i[a].render()});var d=a.map(a=>React.createElement(n,{key:a._id,data:a.data,timestamp:a.timestamp}));ReactDOM.render(React.createElement("table",null,React.createElement("tbody",null,React.createElement(m,null),d)),$("div.content")[0])})})}var e={KERN:0,USER:1,MAIL:2,DAEMON:3,AUTH:4,SYSLOG:5,LPR:6,NEWS:7,UUCP:8,CRON:9,AUTHPRIV:10,FTP:11,NTP:12,SECURITY:13,CONSOLE:14,SOLARIS_CRON:15,LOCAL0:16,LOCAL1:17,LOCAL2:18,LOCAL3:19,LOCAL4:20,LOCAL5:21,LOCAL6:22,LOCAL7:23},f={EMERG:0,ALERT:1,CRIT:2,ERR:3,WARNING:4,NOTICE:5,INFO:6,DEBUG:7},g=a(e),h=a(f),i={facility:new Chart($("#stat_facility_chart")[0],{type:"pie",data:{labels:Object.keys(e),datasets:[{label:"Facility",data:Array(Object.keys(e).length).fill(0)}]},options:{legend:{display:!1}}}),severity:new Chart($("#stat_severity_chart")[0],{type:"pie",data:{labels:Object.keys(f),datasets:[{label:"Severity",data:Array(Object.keys(f).length).fill(0)}]},options:{legend:{display:!1}}}),host:new Chart($("#stat_host_chart")[0],{type:"pie",data:{labels:[],datasets:[{label:"Host",data:[]}]},options:{legend:{display:!1}}})};class j extends React.Component{constructor(a){super(a),this.state={checked:!0}}toggleChange(a){a.setState(a=>({checked:!a.checked}))}render(){return React.createElement("li",null,React.createElement("input",{type:"checkbox","data-type":"facility",value:this.props.value,defaultChecked:this.state.checked,onChange:function(a){return function(){a.toggleChange(a)}}(this)}),this.props.label)}}class k extends React.Component{constructor(a){super(a),this.state={checked:!0}}toggleChange(){this.setState(a=>({checked:!a.checked}))}render(){return React.createElement("li",null,React.createElement("input",{type:"checkbox","data-type":"severity",value:this.props.value,defaultChecked:this.state.checked,onChange:function(a){return function(){a.toggleChange(a)}}(this)}),this.props.label)}}class l extends React.Component{constructor(a){super(a),this.state={checked:!0}}toggleChange(){this.setState(a=>({checked:!a.checked}))}render(){return React.createElement("li",null,React.createElement("input",{type:"checkbox","data-type":"host",value:this.props.value,defaultChecked:this.state.checked,onChange:function(a){return function(){a.toggleChange(a)}}(this)}),this.props.label)}}class m extends React.Component{render(){return React.createElement("tr",null,React.createElement("th",null,"Received Time"),React.createElement("th",null,"Facility"),React.createElement("th",null,"Severity"),React.createElement("th",null,"Host"),React.createElement("th",null,"Process"),React.createElement("th",null,"Message"))}}class n extends React.Component{constructor(a){super(a)}render(){return React.createElement("tr",{"data-severity":this.props.data.PRI_SEVERITY},React.createElement("td",null,new Date(this.props.timestamp).toLocaleString()),React.createElement("td",null,g[this.props.data.PRI_FACILITY]),React.createElement("td",null,h[this.props.data.PRI_SEVERITY]),React.createElement("td",null,this.props.data.HEAD.hostname),React.createElement("td",null,this.props.data.HEAD.process),React.createElement("td",null,this.props.data.MSG))}}b(),d(),$("#filter_apply_btn").on("click",d),$("#filter_updatehost_btn").on("click",b),$("#filter_dtfrom")[0].value=strftime("%Y-%m-%dT%H:%M:%S",new Date(Date.now()-604800000)),$("#filter_dtto")[0].value=strftime("%Y-%m-%dT%H:%M:%S",new Date(Date.now())),$("#filter_lastHour").on("click",function(){var a=new Date,b=new Date;b.setHours(b.getHours()-1),$("#filter_dtfrom")[0].value=strftime("%Y-%m-%dT%H:%M:%S",b),$("#filter_dtto")[0].value=strftime("%Y-%m-%dT%H:%M:%S",a)}),$("#filter_24hrs").on("click",function(){var a=new Date,b=new Date;b.setHours(b.getHours()-24),$("#filter_dtfrom")[0].value=strftime("%Y-%m-%dT%H:%M:%S",b),$("#filter_dtto")[0].value=strftime("%Y-%m-%dT%H:%M:%S",a)}),$("#filter_lastwk").on("click",function(){var a=new Date,b=new Date;b.setHours(b.getHours()-168),$("#filter_dtfrom")[0].value=strftime("%Y-%m-%dT%H:%M:%S",b),$("#filter_dtto")[0].value=strftime("%Y-%m-%dT%H:%M:%S",a)}),$("#filter_thismonth").on("click",function(){var a=new Date,b=new Date;b.setDate(1),b.setHours(0),b.setMinutes(0),b.setSeconds(0),$("#filter_dtfrom")[0].value=strftime("%Y-%m-%dT%H:%M:%S",b),$("#filter_dtto")[0].value=strftime("%Y-%m-%dT%H:%M:%S",a)})})();